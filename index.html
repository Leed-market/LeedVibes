<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LeedVibes</title>
    <link rel="stylesheet" href="css/style.css" media="all">
    <meta name="viewport" content="width=device-width">
    {function="Plugin::callLink()"}
    {function="Plugin::callCss()"}
    <script src="js/modernizr.custom.js"></script>
    <!--[if lte IE 8]>
        <script src="js/respond.js"></script>
    <![endif]-->
    <script src="js/jquery-1.10.2.min.js"></script>
    <script src="js/script.js"></script>
    {function="Plugin::callJs()"}
</head>
<body>
    {function="Plugin::callHook("menu_pre_folder_menu", array(&$myUser))"}
    {if="($myUser!=false) || ($configurationManager->get('articleDisplayAnonymous')=='1')"}
        <aside class="sidebar">
    {/if}
        <div class="settings">
            {if="!$myUser"}
                {if="($configurationManager->get('articleDisplayAnonymous')=='0')"}
                    <h3>{function="_t('YOU_MUST_BE_LOGGED')"}</h3>
                    <p>{function="_t('IF_ADMIN_THEN_CONFIG')"}</p>
                {/if}
                <form action="action.php?action=login" class="settings__fields" method="POST">
                    <input type="text" name="login" tabindex="1" placeholder="{function="_t('LOGIN')"}"/>
                    <input type="password" name="password" tabindex="2" placeholder="{function="_t('PASSWORD')"}"/>
                    <input type="submit" value="{function="_t('LEEDVIBES_CONNECTION')"}" tabindex="4" />
                    <label class="rememberMe">
                        <input type="checkbox" tabindex="3" name="rememberMe" />
                        <span>{function="_t('REMEMBER_ME')"}</span>
                    </label>
                </form>
            {else}
                {function="_t('IDENTIFIED_WITH',array('<span class="settings__username">'.$myUser->getLogin().'</span>'))"}
                <a href="action.php?action=logout">{function="_t('DISCONNECT')"}</a>
                <a href="settings.php">{function="_t('MANAGE')"}</a>
                {* [todo] - Find a better sign to go to the events *}
                <a href="#articles" class="settings__go-to-events">V</a>
            {/if}
        </div>
        {if="($configurationManager->get('articleDisplayAnonymous')=='1') || ($myUser!=false)"}
            <ul>
                <li class="folder">
                    <div class="feed-all__item{if="(!isset($currentFolder)) && (!isset($currentFeed))"} selected{/if}">
                        <a href="./">All feeds</a>
                        <button class="mark-as-read js-mark-as-read js-total-counter" title="{function="_t('LEEDVIBES_MARK_ALL_AS_READ')"}">{$unread['total']}</button>
                    </div>
                </li>
                <!-- [todo] -  Remove order=unread on feeds' links, use the settings instead -->
                {loop="folders"}
                    {$feeds=""}
                    {if="isset($allFeedsPerFolder[$value->getId()])"}
                        {$feeds=$allFeedsPerFolder[$value->getId()]}
                    {/if}
                    {if="isset($allEvents[$value->getId()])"}
                        {$unreadEventsForFolder=$allEvents[$value->getId()]}
                    {/if}
                    <li class="folder js-folder" data-id="{$value->getId()}">
                        <div class="folder__item js-folder__item{if="isset($currentFolder) && ($value->getId() == $currentFolder->getId())"} selected{/if}">
                            <button class="folder__button js-toggle-button">{if="!$value->getIsopen()"}&#9656;{else}&#9662;{/if}</button>
                            {function="Plugin::callHook("menu_pre_folder_link", array(&$value))"}
                            <a href="index.php?action=selectedFolder&amp;folder={$value->getId()}" title="{function="_t('READ_FOLDER_ITEMS')"}">{function="htmlentities($value->getName())"}</a>
                            {if="$unreadEventsForFolder > 0"}
                                <button class="mark-as-read js-mark-as-read js-folder-counter" title="{function="_t('MARK_AS_READ_FOLDER_ITEMS',array($unreadEventsForFolder))"}">{$unreadEventsForFolder}</button>
                            {/if}
                            {function="Plugin::callHook("menu_post_folder_link", array(&$value))"}
                        </div>
                        <ul class="feed js-toggle-item{if="!$value->getIsopen()"} hidden{/if}">
                            {if="count($feeds)!=0"}
                                {loop="feeds"}
                                    <li class="feed__item js-feed__item{if="isset($currentFeed) && ($value2['id'] == $currentFeed->getId())"} selected{/if}" data-id="{$value2['id']}">
                                        {function="Plugin::callHook("menu_pre_feed_link", array(&$value))"}
                                        <a href="index.php?action=selectedFeed&amp;feed={$value2['id']}&amp;order=unread" title="{function="htmlentities($value2['url'])"}">{if="isset($value2['favicon'])"}{$value2['favicon']}{/if} {function="htmlentities($value2['name'])"}</a>
                                        {if="isset($unread[$value2['id']]) && $unread[$value2['id']] > 0"}
                                            <button class="mark-as-read js-mark-as-read js-feed-counter" title="{function="_t('MARK_AS_READ')"}">{$unread[$value2['id']]}</button>
                                        {/if}
                                {function="Plugin::callHook("menu_post_feed_link", array(&$value))"}
                                    </li>
                                {/loop}
                            {/if}
                        </ul>
                    </li>
                    {$unreadEventsForFolder=0}
                {/loop}
            </ul>
        {/if}
    {if="($myUser!=false) || ($configurationManager->get('articleDisplayAnonymous')=='1')"}
        </aside>
    {/if}
    {function="Plugin::callHook("menu_post_folder_menu", array(&$myUser))"}
    
    {if="($configurationManager->get('articleDisplayAnonymous')=='1') || ($myUser!=false)"}
        <section id="articles" class="wrapper">
            {if="count($events) > 0"}
                {include="article"}
            {else}
                <div class="infinite-scroll--end">
                    {function="_t('LEEDVIBES_NOTHING_TO_READ')"}
                </div>
            {/if}
        </section>
    {/if}
    <script>
        var  i18n = {$i18n_js};
    </script>
</body>
</html>
